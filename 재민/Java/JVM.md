# JVM

### JVM

자바 가상 머신은 자바 프로그램 실행환경을 만들어 주는  소프트웨어 

자바 코드를 컴파일하여 .class 바이트 코드로 만들면 이 코드가 JVM에서 실행됨

## JVM의 구성

크게 네가지 구성요소

- Class Loader (클래스 로더)
    - 바이트 코드 실행 시 .class 객체를 메모리 상에 로드하는 요소
- Execution Engine (실행 엔진)
    - 메모리에 로드된 바이트 코드를 실행하는 요소
- Runtime Data Area
    - JVM의 메모리 영역으로 Method 영역, Heap 영역은 모든 스레드에서 공유하며 스택 영역과 네이티브 메서드 스택 영역 등은 스레드 별로 독립적인 메모리 공간을 갖음
- Carbage Collectors (GC)
    - 더 이상 참조하지 않는 Heap 영역의 메모리를 정리

## JVM 실행과정

1. 자바로 개발된 프로그램을 실행 시 JVM은 OS로부터 메모리를 할당
2. 자바 컴파일러가 자바 소스코드(.java)를 자바 바이트코드(.class)로 컴파일
3. Class Loader를 통해 JVM Runtime Data Area로 로딩
4. Runtime Data Area에 로딩 된 .class들은 Execution Engine을 통해 해석
5. 해석된 바이트 코드는 Runtime Data Area의 각 영역에 배치되어 수행하며 이 과정에서 Execution Engine에 의해 GC의 작동과 스레드 동기화가 이뤄짐 

## JVM 메모리(Runtime Data Area) 구조

런타임 데이터 영역은 JVM의 메모리 영역으로 자바 애플리케이션을 실행할 때 사용되는 데이터들을 적재하는 영역

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5065977e-5ae4-4368-b4b2-f3bbeb807ed0/Untitled.png)

- Method Area
    - JVM이 실행될 때 생성되는 공간
    - 바이트 코드(.class)를 처음 메모리 공간에 올릴 때 초기화되는 대상을 저장하기 위한 메모리 공간
    - JVM이 동작하고 클래스가 로드될 때 적재되서 프로그램이 종료될 때까지 저장됨
- Heap Area
    - new 키워드로 생성된 객체와 배열이 생성되는 영역
    - 주기적으로 GC가 제거하는 영역
- Stack Area
    - 지역변수, 파라미터, 리턴 값 등 이 생성되는 영역
- PC Register
    - 스레드가 생성될 때마다 생성되는 영역으로 현재 스레드가 실행되는 부분의 주소와 명령을 저장하고 있는 영역
- Native Method Stack
    - 자바 이외의 언어(C, C++ 등)로 작성된 네이티브 코드를 실행할 때 사용되는 메모리 영역으로 일반적인 C 스택을 사용
    - 보통 C/C++ 등의 코드를 수행하기 위한 스택(JNI : 네이티브 메소드들이 바이트 코드로 변환되면서 사용되고 기록)
    - 자바 컴파일러에 의해 변환된 자바 바이트코드를 읽고 해석하는 역할을 하는 것이 자바 인터프리터(interpreter)

## (면접) JVM

### JVM이란?

JVM은 자바 가상 머신으로 자바 프로그램 실행환경을 만들어 주는 소프트웨어 입니다.

### JVM의 구성요소?

JVM구성요소는 크게 4가지로 클래스 로더, 실행 엔진, 런타임 데이터 영역, 가비지 컬렉터로 구성됩니다.

### JVM의 실행과정?

JVM의 실행과정은 1단계 자바 프로그램 실행 시 JVM이 OS로 메모리를 할당받습니다.  2단계 자바 컴파일러가 자바 소스코드를 자바 바이트코드로 변환합니다. 3단계 클래스 로더로 런타임 데이터 영역으로 로딩합니다. 4단계 실행 엔진을 통해 해석합니다. 5단계 해석된 바이트 코드는 런타임 데이터 영역의 각 영역에 배치되며 수행되고 이 과정에서 GC의 작동과 스레드 동기화가 이뤄집니다.
