# 트랜잭션

### 트랜잭션 개념

- 트랜잭션은 데이터베이스의 상태를 변화시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한번에 수행되어야할 일련의 연산들을 의미
- 트랜잭션은 작업의 완전성을 보장하여 논리적인 작업 셋을 모두 완벽하게 처리하거나 처리하지 못할 경우 원 상태로 복구
- 트랜잭션은 SELECT, UPDATE, INSERT, DELETE와 같은 연산을 수행하여 데이터베이스의 상태를 변화시키는 작업의 단위

### 트랜잭션의 특징(ACID)

- Atomicity(원자성)
    - 트랜잭션이 데이터베이스에 모두 반영되거나 모두 반영되지 않음
    - 트랜잭션 내의 모든 명령은 반드시 완벽하게 수행되어야 하며 모두가 완벽하게 수행되지 않을 시 트랜잭션 전부가 취소되어야 함
- Consistency(일관성)
    - 트랜잭션의 작업 처리 결과에는 항상 일관성이 있어야 함
    - 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 수행 후의 상태가 같아야 함
- Isolation(독립성)
    - 둘 이상의 트랜잭션이 동시에 실행되고 있을 경우 어떤 하나의 트랜잭션이라도 다른 트랜잭션의 연산에 끼어들 수 없음
    - 수행 중인 트랜잭션은 완전히 완료될 때 까지 다른 트랜잭션에서 수행 결과를 참조할 수 없음
- Durability(지속성)
    - 트랜잭션이 성공적으로 완료되었을 경우 결과는 영구적으로 반영

### 트랜잭션의 상태

- 활동(Active) : 트랜잭션이 실행중이며 동작중인 상태
- 부분완료(Partially Committed) : 트랜잭션의 Commit 명령이 도착한 상태로 Commit 이전 sql문이 수행되고 Commit만 남은 상태
- 완료(Committed) : 트랜잭션이 정상적으로 완료된 상태
- 실패(Failed) : 트랜잭션이 더이상 정상적으로 진행될 수 없는 상태
- 취소(Aborted) : 트랜잭션이 취소되고 트랜잭션 실행 이전으로 데이터가 돌아간 상태

### 트랜잭션 격리 수준

동시에 여러 트랜잭션이 처리될 때 트랜잭션끼리 얼마나 서로 고립되어 있는지를 나타내는 것으로 특정 트랜잭션이 다른 트랜잭션에 변경하거나 조회하는 데이터를 볼 수 있도록 허용할지 말지 결정하는 것

격리수준을 낮추면 동시성이 높아지나 데이터 무결성 보장이 어려움

격리수준을 높이면 동시성이 낮아지나 데이터 무결성이 보장됨

- LV0. READ UNCOMMITTED(커밋되지 않은 읽기)
    - 어떤 트랜잭션의 변경내용이 COMMIT, ROLLBACK과 상관없이 다른 트랜잭션에서 보여짐
    - Dirty Read 발생 - 하나의 트랜잭션에서 작업이 완료되지 않았는데도 다른 트랜잭션에서 볼 수 있게 되는 현상
    - Non-Repeatable Read 발생 - 한 트랜잭션에서 같은 쿼리를 두번 실행 했을 때 다른 값이 나오는 현상(특정 데이터에 대한 수정이 발생하여 나타나는 Read 현상)
    - Phantom Read 발생 - 하 트랜잭션 안에서 첫번째 쿼리에서 없던 유령(Phantom) 레코드가 두 번째 쿼리에서 나타나는 현상(결과 범위에 속하지 않은 레코드가 외부 작업에 의해 있을 수도 있고 없어질 수도 있다는 것)
- LV1. READ COMMITTED(커밋된 읽기)
    - 어떤 트랜잭션의 변경 내용이 COMMIT 되어야만 다른 트랜잭션에서 조회 가능
    - Non-Repeatable Read 발생
    - Phantom Read 발생
- LV2. REPEATABLE READ(반복 가능한 읽기)
    - 트랜잭션이 시작되기 전에 커밋된 내용에 대해서만 조회 가능
    - 자신의 트랜잭션 번호보다 낮은 트랜잭션 번호에서 변경된 것만 보게 됨
    - Phantom Read 발생
- LV3. SERIALIZABLE(직렬화 가능)
    - 가장 단순하고 가장 엄격한 격리수준
    - 트랜잭션에서 읽고 쓰는 레코드는 다른 트랜잭션에서 절대 접근할 수 없음
    - 읽기작업조차도 Lock을 걸기에 동시에 접근할 수 없어 동시성이 낮아짐

## (면접) 트랜잭션(개념, 특징. 상태, 격리수준)

트랜잭션이란 데이터베이스의 상태를 변화시키는 하나의 논리적 기능을 수행하기 위한 하나의 작업처리 단위를 말합니다. 

트랜잭션의 특징으로는 트랜잭션이 데이터베이스에 모두 반영되거나 모두 반영되지 않는 원자성, 트랙잭션의 처리결과가 가지는 일관성, 수행 중인 트랜잭션에 다른 트랜잭션이 끼어들 수 없는 독립성, 트랜잭션이 끝난 경우 결과를 영구적으로 반영하는 지속성이 있습니다. 

트랜잭션은 활동, 부분완료, 완료, 실패, 취소의 상태를 가집니다. 활동과 부분완료의 차이로는 활동은 트랜잭션이 동작중인 상태며 부분완료는 sql이 수행되고 Commit명령이 들어온 상태입니다.

트랜잭션 격리수준은 동시에 여러 트랜잭션이 처리될 때 다른 트랜잭션이 변경하거나 조회하는 데이터를 허용할지 말지를 결정하는것을 말합니다. 격리수준으로는 READ UNCOMMITTED(커밋되지 않은 읽기), READ COMMITTED(커밋된 읽기), REPEATABLE READ(반복 가능한 읽기), SERIALIZABLE(직렬화 가능)이 있습니다. 격리수준을 낮추면 동시성이 높아지지만 데이터 무결성을 보장받기 어려우며 격리수준을 높이면 동시성이 낮아지지만 데이터 무결성을 보장받을 수 있습니다.
