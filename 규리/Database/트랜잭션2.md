2023/01/18

### 🧑‍💻 **기술블로깅 TechBlog** 🪚

<aside>
💡 Transaction - Commit, Rollback

</aside>

* 공부를 위해서 하는 블로깅으로 잘못된 정보가 있을 수 있습니다.

<br><br>

## [ DB ] 트랜잭션2

**🔩 Commit**

---

완전 저장

**모든 작업들을 정상적으로 처리하겠다고 확정하는 명령어, 처리과정을 DB에 영구 저장하는 것**

트랜잭션이 성공하여 트랜잭션 결과를 영구적으로 반영하는 연산

하나의 트랜잭션 과정을 종료하는 것

이전 데이터는 완전히 UPDATE 됨

<br><br>

**🔩 Rollback**

---

**작업 중 문제가 발생되어 트랜잭션의 처리과정에서 발생한 변경사항을 취소하는 명령어**

마지막 COMMIT을 완료한 시점으로 다시 돌아가는 것

트랜잭션 실행 취소를 알리는 연산

COMMIT하여 저장한 것만 복구

<br><br>

**🔩 동시성 제어**

---

<br>

<img width="650" src="https://user-images.githubusercontent.com/107545016/213449491-2271714d-a9f0-48c6-9e35-767e4bbcde9e.png" />

<br>

동시에 실행되는 여러 개의 트랜잭션이 작업을 성공적으로 마칠 수 있도록 트랜잭션의 실행 순서를 제어하는 기법

트랜잭션이 동시에 수행될 때, 일관성을 해치지 않도록 트랜잭션의 데이터 접근을 제어하는 DBMS의 기능

다중 사용자 환경을 지원하는 데이터 베이스 시스템에서 여러 트랜잭션들이 성공적으로 동시에 실행될 수 있도록 지원하는 기능

다중 사용자 환경을 지원하는 DB system의 경우 필수적으로 지원해야 하는 기능 → 병행제어

트랜잭션의 직렬화 수행 보장

<br><br>

**+ 동시성 제어 목적**

---

- 트랜잭션의 직렬성 보장
- 공유도 최대, 응답 시간 최소, 시스템 활동의 최대 보장
- 데이터의 무결성 및 일관성 보장

<br><br>

**+ 동시성 제어 종류**

---

- **락킹** Locking
    
    트랜잭션이 데이터에 잠금을 설정하면 다른 트랜잭션은 해당 데이터에 대해 잠금이 해제될 때까지 접근, 수정, 삭제 불가
    
- **타임스탬프** Timestamp
    
    시스템에서 생성하는 고유 번호인 타임스탬프를 트랜잭션에 부여하여 트랜잭션간의 접근 순서를 미리 정함
    
- **적합성 검증** Validation
    
    트랜잭션 수행 후 트랜잭션을 종료할 때 적합성을 검증하여 데이터베이스에 최종 반영
    
<br><br>

**+ 동시성 제어 문제점**

---

- **갱신 분실** Lost Update
    
    하나의 트랜잭션이 갱신한 내용을 다른 트랜잭션이 덮어씀으로써 갱신이 무효화가 되는 것
    
    두 개이상 트랜잭션이 한 개의 데이터를 동시에 갱신(Update)할 때 발생
    
- **현황파악오류** Dirty Read
    
    읽기 작업을 하는 트랜잭션이 쓰기 작업을 하는 트랜잭션이 작업한 중간 데이터를 읽기 때문에 발생하는 문제
    
    쓰기 작업중인 트랜잭션이 Rollback한 경우 읽기 작업을 하는 트랜잭션은 무효가 된 데이터를 읽게 되고 잘못된 결과를 도출하게 됨
    
- **모순성** Inconsistency
    
    다른 트랜잭션들이 해당 항목 값을 갱신하는 동안 한 트랜잭션이 두 개의 항목 값 중 어떤 것은 갱신되기 전의 값을 읽고 다른 것은 갱신된 후의 값을 읽게 되어 데이터의 불일치가 발생
    
- **연쇄복귀** Cascading Rollback
    
    두 트랜잭션이 동일한 데이터 내용을 접근할 때 발생
    
    한 트랜잭션이 데이터를 갱신한 다음 실패하여 Rollback 연산을 수행하는 과정에서 갱신과 Rollback 연산을 실행하고 있는 사이에 해당 데이터를 읽어서 사용할 때 발생
    

<br><br>

🔩 **예비 답변**

---

Q. Commit에 대해 말해보세요.

**Commit**은 모든 작업들을 정상적으로 처리하겠다고 확정하는 명령어로, 처리과정을 DB에 영구 저장하는 것입니다. Commit을 수행하면 하나의 트랜잭션 과정이 종료되고, 이전 데이터가 완전히 `UPDATE` 됩니다.

<br>

Q. Rollback에 대해 말해보세요.

**Rollback**은 작업 중 문제가 발생되어 트랜잭션의 처리과정에서 발생한 변경사항을 취소하는 명령어로, 마지막 `commit`을 완료한 시점으로 다시 돌아가는 것입니다. Rollback을 수행하면 `commit`하여 저장한 것만 복구됩니다.

<br>

Q. 동시성 제어에 대해 말해보세요.

**동시성 제어**는 동시에 실행되는 여러 개의 트랜잭션이 작업을 성공적으로 마칠 수 있고, 트랜잭션들이 DB의 일관성을 파괴하지 않도록 트랜잭션의 실행 순서를 제어하는 기법입니다. 

동시성 제어 종류로는 트랜잭션이 데이터에 잠금을 설정하면 다른 트랜잭션은 해당 데이터에 대해 잠금이 해제될 때까지 접근과 수정, 삭제가 불가하도록 하는 **락킹**과, 트랜잭션에 타임스탬프를 부여하여 트랜잭션간의 접근 순서를 미리 정하는 **타임스탬프**, 트랜잭션을 종료 시 진행하는 **적합성 검증**이 있습니다.

이러한 동시성 제어는 트랜잭션의 직렬성 보장이나 데이터의 무결성과 일관성 보장 등의 장점이 있지만, 하나의 트랜잭션이 갱신한 내용을 다른 트랜잭션이 덮어쓰게 되어 갱신이 무효화가 되거나 잘못된 결과 또는 데이터의 불일치가 발생할 수 있다는 문제가 있습니다.

<br><br>

🔩 **참고**

---

블로그

[10. 트랜잭션 BEGIN , COMMIT, ROLLBACK](https://velog.io/@syh0397/10.-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-BEGIN-COMMIT-ROLLBACK)

[[ 기술면접 / 데이터베이스 ] 동시성 제어( Concurrency Control )](https://jokerkwu.tistory.com/125)

<br><br>
