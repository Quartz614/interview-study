2023/01/17

### 🧑‍💻 **기술블로깅 TechBlog** 🪚

<aside>
💡 JVM, Java Virtual Machine

</aside>

* 공부를 위해서 하는 블로깅으로 잘못된 정보가 있을 수 있습니다.

<br><br>

## [ Java ] JVM

**🔩 JVM**

---

JVM, Java Virtual Machine

**자바 프로그램 실행환경을 만들어 주는 소프트웨어**

OS에 종속받지 않고 CPU가 Java를 인식하고 실행할 수 있도록하는 가상 컴퓨터

*하나의 바이트 코드(.class)로 모든 플랫폼에서 동작하도록 할 수 있음*

Java는 플랫폼에 종속적이지 않지만 JVM은 플랫폼에 종속적임

<br><br>

**🔩 JVM 구성요소**

---

1. **자바 인터프리터** Interpreter
2. **클래스 로더** Class Loader
3. **JIT 컴파일러** Just-In Time Compiler
4. **가비지 컬렉터** Garbage Collecter

<br><br>

**+ 자바 인터프리터**

---

**자바 컴파일러에 의해 변환된 바이트 코드를 읽고 한 줄씩 기계어로 해석**

JVM 실행 엔진이 바이트 코드를 명령어 단위로 읽어서 실행

느다는 단점이 있음

<br><br>

**+ 클래스 로더**

---

**JVM 내 Class 파일을 로드하고 링크**

동일한 메소드를 여러 번 호출할 때 매번 해석하는 것을 방지

인터프리터 방식으로 실행하다가 적절한 시점에 바이트 코드 전체를 컴파일하여 native 코드로 변경하고, 이후에는 더 이상 인터프리팅 하지 않고 네이티브 코드로 직접 실행하는 방식

내부적으로 특정 메서드가 얼마나 자주 수행되는지 체크하고, 일정 정도를 넘을 때에만 컴파일 수행

<br><br>

**+ JIT 컴파일러**

---

**인터프리터 방식의 단점을 보완하기 위해 도입된 JIT 컴파일러**

한 번에 메모리에 모든 클래스를 로드하는 것이 아닌, 필요한 순간에 해당 클래스(.class) 파일을 찾아 메모리에 로딩해주는 역할

효율적인 수행을 위해 지연 로딩(Lazy-Loading)과 캐싱(Caching)같은 기법 활용

<br><br>

**+ [가비지 컬렉터](https://www.notion.so/Java-e6c4b99f7a414cc0b139ff66f34959f5)**

---

**메모리를 할당하고 사용하지 않지만 할당되어 있는 메모리를 해제시킴**

자동으로 메모리 관리

<br><br>

🔩 **JVM 실행과정**

---

1. OS로부터 메모리(Runtime Data Area) 할당
2. 컴파일러(javac)가 소스코드(.java)를 읽어 바이트 코드(.class)로 변환
3. Class Loader를 통해 Class파일을 JVM내 Runtime Data Area로 로딩
4. 로딩된 Class 파일을 Execution Engine을 통해 해석 및 실행

<br><br>

🔩 **JVM 메모리(Runtime Data Area) 구조**

---

- 메서드(static) 영역
- JVM 힙 영역
- JVM 스택 영역
- PC Register
- Native Method Stack

<br><br>

**+ 메서드 영역**

---

= static 영역

클래스 사용 시 해당 클래스의 파일(.class)을 읽고, 클래스에 대한 정보(바이트 코드) 저장

- 클래스 정보, static 변수, 변수 정보, 메소드 정보 등 저장
- static (전역)변수는 어디든 접근이 가능해지므로 읽기 전용이 아닌 경우는 가능한 사용하지 않음
- JVM이 동작해서 클래스가 로딩될 때 생성
- JVM이 종료될때까지 유지

<br><br>

**+ 힙 영역**

---

인스턴스를 생성할 때 생성되는 메모리 형식 저장

- `new` 사용하여 객체를 만들 때 저장
- 런타임 시 동작으로 할당
- 참조형(class, interface, enum, Array 등) 자료형도 같이 저장
- 힙의 참조 주소는 스택이 갖고 있고 해당 객체를 통해서만 힙 영역에 있는 인스턴스 핸들링 가능

<br><br>

**+ 스택 영역**

---

기본 자료형 생성 시 저장하는 공간으로, 임시적으로 사용되는 변수나 정보들 저장

- 지역변수, 매개변수, 연산 중 발생하는 임시 데이터 저장
- 스레드마다 존재, 스레드 시작 시 할당
- 메소드가 호출될 때마다 생성하고, 메서드 실행이 끝나면 pop되어 제거

<br><br>

**+ PC Register**

---

스레드가 현재 실행할 스택 프레임의 주소 저장

<br><br>

**+ Native Method Stack**

---

C/C++ 등 Low Level 코드 실행

<br><br>

🔩 **예비 답변**

---

Q. JVM에 대해 말해보세요.

**JVM**은 자바 프로그램 실행환경을 만들어 주는 소프트웨어로 OS에 종속받지 않고 CPU가 Java를 인식하고 실행할 수 있도록하는 가상 컴퓨터입니다.

<br>

Q. JVM의 구성 요소에 대해 말해보세요.

JVM은 자바 인터프리터, 클래스 로더, JIT 컴파일러, 가비지 컬렉터로 구성되어 있습니다.

**자바 인터프리터**는 자바 컴파일러에 의해 변환된 바이트 코드를 읽고 한 줄씩 기계어로 해석하는 것이며, 

**클래스 로더**는 JVM 내 Class 파일을 로드하고 링크하여 동일한 메소드를 여러 번 호출할 때 매번 해석하는 것을 방지합니다.

**JIT 컴파일러**는 인터프리터 방식의 단점을 보완하기 위해 도입된 JIT 컴파일러로 필요한 순간에 해당 클래스 파일을 찾아 메모리에 로딩해주는 역할을 합니다.

마지막으로 **가비지 컬렉터**는 메모리를 할당하고 사용하지 않지만 할당되어 있는 메모리를 자동으로 해제시키는 역할을 합니다.

<br>

Q. JVM의 실행과정에 대해 말해보세요.

JVM은 OS로 부터 메모리를 할당받고 컴파일러를 통해 소스코드를 읽어 바이트 코드로 변환합니다. 이후 클래스 로더를 통해 클래스파일을 JVM 내 메모리로 로딩하고 로딩된 클래스파일을 Execution Engine을 통해 해석하고 실행합니다.

<br>

Q. JVM의 메모리 구조에 대해 말해보세요.

JVM의 메모리 구조는 메서드 영역, 힙 영역, 스택 영역, PC Resigter 영역, Native Method Stack 영역으로 구분되어 있습니다. 

메서드 영역은 클래스 사용 시 해당 클래스의 파일을 읽고, 클래스에 대한 정보를 저장하는 영역이고, 

힙 영역은 `new` 사용하여 객체를 만들거나 인스턴스를 생성할 때 생성되는 메모리 형식을 저장하는 영역입니다.

스택 영역은 기본 자료형 생성 시 저장되는 공간으로, 임시적으로 사용되는 변수나 정보들 저장하는 영역입니다.

PC Register는 스레드가 현재 실행할 스택 프레임의 주소 저장하는 영역이며, 

마지막으로 Native Method Stack은 C나 C++ 등의 Low Level 코드를 실행하는 스택 영역입니다.

<br><br>

🔩 **참고**

---

블로그

[[Java] 자바 가상머신 JVM(Java Virtual Machine) 총정리](https://coding-factory.tistory.com/827)

[Java - JVM 구성 요소와 역할 정리! (+ JIT 컴파일러, 인터프리터, 클래스 로더, 가비지 컬렉터란 무엇인가?)](https://jaehoney.tistory.com/173)

[[Java] JVM이란? - (3) 구성 요소](https://siahn95.tistory.com/entry/Java-JVM%EC%9D%B4%EB%9E%80-3-JVM%EC%9D%98-%EB%91%90-%EA%B0%80%EC%A7%80-%EA%B5%AC%EC%84%B1-%EC%9A%94%EC%86%8C)

[[Java] JVM 구조와 메모리 영역 - Method, Heap, Stack Area](https://tape22.tistory.com/28)

<br><br>
